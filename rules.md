# 程序设计的一些原则

对于前端可以重试的，系统不稳定时直接抛出错误；
对于前端不能重试的，系统暂时不可用时，通过落库、消息等将失败的处理存储起来，并进行异步重试。

对于消息，如果一次获取多条，那么如果其中几条消费失败，如何设置消费位移？

对于消息的重复消费问题，需要消费端做对应的幂等处理。
可以通过记录的状态来识别重复消息，比如订单在之前前状态为“未支付”，接收到支付消息後，更新状态为“已支付”。再次接收到重复的支付消息时，查看订单的状态为已支付，则忽略掉该消息。

通过全局唯一的字段来识别重复消息，这要求消息中必须带有的唯一标识字段，如订单ID等。这时可以将已处理消息的唯一标识字段保存起来，当有新消息来的时候，通过比对唯一标识字段，判断消息是否已消费。保存已消费消息的唯一标识字段的途径有多种，可以是关系数据库中的唯一健，也可以是持久化缓存中的key。为了防止保存的key过多，可以根据消息的有效期（消息不会保存太久），定时地去清除保存的key。


有两种解决方案：
1. 
首先，消息中
